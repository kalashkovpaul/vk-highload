# Курс "Проектирование высоконагруженных систем"

**Тема курсовой работы:**
Проектирование сервиса видеозвонков *Zoom*

## Введение в предметую область

[Zoom](https://ru.wikipedia.org/wiki/Zoom_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0)) - проприетарная программа для организации видеоконференций, разработанная компанией Zoom Video Communications. Она предоставляет сервис видеотелефонии, который позволяет подключать одновременно до 100 устройств бесплатно, с 40-минутным ограничением для бесплатных аккаунтов.

В работе акцент будет сосредоточен на возможностях создания видеозвонков.

## Целевая аудитория

На декабрь 2020 года [[1.1]](#source-1) в ежедневных видеовстречах принимали участие около 350 миллионов пользователей.
К 2022 году месячная аудитория сайта zoom.us в России была около 23 миллионов пользователей [[1.2]](#source-1).

Учитывая статистику 2021 года и то, что в СНГ приблизительно 2% пользователей Zoom можно высчитать, что количество пользователей = 350 * 0.02 ~= 7 млн..
Это число показывает ежедневную аудиторию сервиса, однако, это не уникальные инспользования. Один человек может несколько раз участвовать в конференции.
Пусть каждый человек в среднем делает по 3 звонка. Тогда 7 / 3 ~= 2 млн => в СНГ ежедневная нагрузка сервиса может достигать 2 млн пользователей.

Таким образом, целевая аудитория для проектируемого сервиса следующая:
- Страны СНГ;
- Пользователи в возрасте 18 - 50 лет;

Сводная таблица:
| Месячная аудитория в СНГ | Еждневная нагрузка (кол-во сессий) | Дневная нагрузка по пользователям |
|--------------------------|------------------------------------|-----------------------------------|
| 23 млн                    | 7 млн                              | 2 млн                             |


## Минимально жизнеспособный продукт
Минимальные требования для MVP:
- возможность авторизации и регистрации;
- возможность создавать видеоконференции с требованиями:
    - связь по видео и / или аудио;
    - наличие текстового чата для всех участников (с возможностью отправлять сообщения для отдельный участников);
    - возможность создать запись видеоконференций;
    - возможность добавлять / удалять участников (максимальное количество - 50)
- возможность вступать в видеоконференцию по ссылке

## Нагрузка
Для расчёта нагрузки опишем продуктовые и технические метрики, которые определять все необходимые числа.
### Продуктовые метрики
Рассмотрим такие продуктовые метрики, как месячная и дневная аудитория, предполагаемые средние количества действий пользователя за день, а также предполагаемый средний объём данных, которые занимает пользователь.

1. Месячная аудитория - 23 млн. чел. (см выше)
2. Дневная аудитория - 2 млн. чел.
Из этого следует: 2 * 30 = 60 млн. чел пользователей в месяц, но уникальных из них 23, поэтому средний пользователь заходит примерно 3 раза в месяц.
3. Рассмотрим такие действия, как:
    - Авторизация / регистрация: 10 раз в месяц, т.е. 0.333 в день.
    - Создание конференции: 1 раз в день 3 раза в месяц (т.е. 3 раз в месяц).
    - Присоединение к конференции: 2 раза в день 3 раза в месяц (6 раз в месяц в среднем по часу в день).
    - Отправка сообщений в чат: 10 сообщений за конференцию, т.е. 20 в день (180 в месяц)
    - Сохранение записей: в среднем 5 записей в месяц, 0.16 записей в день
4. Средний размер хранилища на одного пользователя:
    - Фото польователя и персональная информация - 1 Мб
    - Записи конференций: 5 записей приблизительно равны 5 часам видео в месяц. 1 час видео в формате HD занимает примерно 1 Гб, т.е.  5 Гб в месяц
    - Планирование конференций, информация о ссылках и т.п. - 500 символов на запись, в UTF-8 500 * 1 = 500 байт

### Оценка аудитории
Для определённой выше целевой аудитории предполагаемые оценки равны:
- Дневная аудитория: примерно 2 млн. уникальных пользователей
- Месячная аудитория: 24 миллиона пользователей

### Технические метрики
<ins>Примечание:</ins> пусть
- в 1 конференции чат содержит в среднем 25000 символов или 4250 слов (в среднем 6 символов слово)
- строки хранятся в формате UTF-8 => 1 символ занимает 1 байт.
- в 1 сообщении 25 символов.
- считаем, что сервисом польлзуется 25 миллионов пользователей.
- одна сессия занимает 16 + 8 байт = 24 байта (sessionID, userID)
- один звонок (информация об участниках конференции) - 32 байта на запись.
- пользователь в среднем 60 % времени конференции использует видеокамеру и 40% времени аудио
- средняя длительность 1 звонка = 54 минуты [[1.3]](#source-3), округлим до 1 часа

На основе вышеперечисленных данных определим размер требуемого хранилища, средний и пиковый сетевой трафики, а также RPS для описанных выше действий пользователя.

1. Требуемый размер хранилища данных:
  - Персональные данные (профиль) = 25.000.000 * 1 Мб = 23.84 Тб
  - Записи конференций = 5 Гб * 12 * 25.000.000 = 4 394 531 ~= 1.5 миллионов Тб за год
  - Записи чатов = 25.000.000 * 2(кол-во конференций в день) * 365 *  25 000 * 8 * = 110 ТБ за год
  - Хранилище сессий: 2 000 000 * 24 * 2 * 0.5 = 46 МБ.
  - Хранилища звонков: 2 000 000 × (32 байта * 2) * 365 = 44 ГБ в год.

2. Средний сетевой трафик

- По данным официального сайта Zoom [[1.4]](#source-4), для видео формата HD пропускная способность должна быть 1.8 МБит/с на загрузку, FULL HD - 3 МБит/с -> возьмем среднее (1.8 + 3) / 2 = 2.4 Мбит/с на пользователя
- 1 конференция длится 1 час -> пропускная способность на пользователя 2.4 * 3600 = 8640 Мбит/час = 8.64 ГБит/час
- Для всех пользователей: 8.64 * 2 000 000 * 0.6 = 10 368 000 ГБит/ч (примечание: используется число 0.6, т.к. 60% времени используется видео)
- Передача аудио = 16 Кбит/с * 10^(-6) * 2 000 000 * 3600 * 0.4 = 46080 Гбит/ч
- Сохранение записи в облаке: По данным официального сайта Zoom [[1.4]](#source-4), на HD видео скорость выгрузки должна быть не менее 1.2 МБ/с
- Для всех пользователей: 1.25 Мбит/с * 10^-3 * 2 000 000 * 0.16 = 400 Гбит/ч

3. Пиковый сетевой трафик. Предположим, что в пиковый час нагрузка составляет 30% от дневной нагрузки, т.е. 600 тысяч человек.
- 80 % времени используется видео и звук.
- Пиковая нагрузка: 8.64 * 600 000 * 2ч / 24ч * 0.8 + 16 Кбит/с * 10^(-6) * 600 000 * 2ч / 24ч * 3600 * 0.6 + 1.25 Мбит/с * 10^-3 * 600 000 * 2ч / 24ч * 0.16 = 4.18 * 10^5 ГБит/ч = 117 ГБит/с


4. RPS при разбивке, соответствующей описанным выше действиям

RPS можно посчитать по формуле: {число заходов на страницу одного человек} * 2 000 000 { число пользователь в день } / 24 / 60 / 60
- Регистрация и авторизация: 2 000 000 * 0.33 / 24 / 60 / 60 = 8 rps
- Создание и удаление конференции: 2 000 000 * 0.1 * 2 / 24 / 60 / 60 = 5 rps
- Участие в конференции: 2 000 000 * 0.2 * (2 {получение звука и видео}) * 2 {присоединение, отсоединение} / 24 / 60 / 60 = 37 rps
- Редактирование профиля: 2 000 000 * 0.1 / 24 / 60 / 60 = 2.3 rps
- Сохранение видеозаписи: 2 000 000 * 0.16 / 24 / 60 / 60 = 3.7 rps
- Отправка сообщений в чат: 2 000 000 * 20 / 24 / 60 / 60 = 460 rps

Суммарно: 516 rps


## Использованные источники
1. <a id="source-1"></a>[Статистические данные по zoom декабрь 2020](https://www.businessofapps.com/data/zoom-statistics/)
2. <a id="source-2"></a>[Месячная статистика помещаемости в РФ](https://www.statista.com/statistics/1117659/average-traffic-on-remote-working-platforms-in-russia/)
3. <a id="source-3"></a>[Данные по использованию Zoom в 2021](https://blog.zoom.us/how-you-zoomed-over-the-past-year-2021/)
4. <a id="source-4"></a>[Системные требования Zoom для ОС Windows, macOS и Linux
](https://support.zoom.us/hc/ru/articles/201362023-%D0%A1%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%BD%D1%8B%D0%B5-%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-Zoom-%D0%B4%D0%BB%D1%8F-%D0%9E%D0%A1-Windows-macOS-%D0%B8-Linux)
5. <a id="source-5"></a>[Zoom UserStats: How Many People Use Zoom in 2022? (доступно только с VPN)](https://backlinko.com/zoom-users)
